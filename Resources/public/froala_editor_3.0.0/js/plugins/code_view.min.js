!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("FroalaEditor")):"function"==typeof define&&define.amd?define(["FroalaEditor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e,Object.assign(e.DEFAULTS,{codeMirror:window.CodeMirror,codeMirrorOptions:{lineNumbers:!0,tabMode:"indent",indentWithTabs:!0,lineWrapping:!0,mode:"text/html",tabSize:2},codeBeautifierOptions:{end_with_newline:!0,indent_inner_html:!0,extra_liners:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","ol","table","dl"],brace_style:"expand",indent_char:"\t",indent_size:1,wrap_line_length:0},codeViewKeepActiveButtons:["fullscreen"]}),e.PLUGINS.codeView=function(d){var c,h,f=d.$;function p(){return d.$box.hasClass("fr-code-view")}function u(){return h?h.getValue():c.val()}function g(){p()&&(h&&h.setSize(null,d.opts.height?d.opts.height:"auto"),d.opts.heightMin||d.opts.height?d.$box.find(".CodeMirror-scroll, .CodeMirror-gutters").css("min-height",d.opts.heightMin||d.opts.height):d.$box.find(".CodeMirror-scroll, .CodeMirror-gutters").css("min-height",""))}var m,b=!1;function v(){p()&&d.events.trigger("blur")}function M(){p()&&b&&d.events.trigger("focus")}function i(e){c||(!function l(){c=f('<textarea class="fr-code" tabIndex="-1">'),d.$wp.append(c),c.attr("dir",d.opts.direction),d.$box.hasClass("fr-basic")||(m=f('<a data-cmd="html" title="Code View" class="fr-command fr-btn html-switch'+(d.helpers.isMobile()?"":" fr-desktop")+'" role="button" tabIndex="-1"><i class="fa fa-code"></i></button>'),d.$box.append(m),d.events.bindClick(d.$box,"a.html-switch",function(){d.events.trigger("commands.before",["html"]),A(!1),d.events.trigger("commands.after",["html"])}));var e=function e(){return!p()};d.events.on("buttons.refresh",e),d.events.on("copy",e,!0),d.events.on("cut",e,!0),d.events.on("paste",e,!0),d.events.on("destroy",x,!0),d.events.on("html.set",function(){p()&&A(!0)}),d.events.on("codeView.update",g),d.events.on("form.submit",function(){p()&&(d.html.set(u()),d.events.trigger("contentChanged",[],!0))},!0)}(),!h&&d.opts.codeMirror?((h=d.opts.codeMirror.fromTextArea(c.get(0),d.opts.codeMirrorOptions)).on("blur",v),h.on("focus",M)):(d.events.$on(c,"keydown keyup change input",function(){d.opts.height?this.removeAttribute("rows"):(this.rows=1,0===this.value.length?this.style.height="auto":this.style.height=this.scrollHeight+"px")}),d.events.$on(c,"blur",v),d.events.$on(c,"focus",M))),d.undo.saveStep(),d.html.cleanEmptyTags(),d.html.cleanWhiteTags(!0),d.core.hasFocus()&&(d.core.isEmpty()||(d.selection.save(),d.$el.find('.fr-marker[data-type="true"]').first().replaceWith('<span class="fr-tmp fr-sm">F</span>'),d.$el.find('.fr-marker[data-type="false"]').last().replaceWith('<span class="fr-tmp fr-em">F</span>')));var t=d.html.get(!1,!0);d.$el.find("span.fr-tmp").remove(),d.$box.toggleClass("fr-code-view",!0);var n,i,r=!1;if(d.core.hasFocus()&&(r=!0,d.events.disableBlur(),d.$el.blur()),t=(t=t.replace(/<span class="fr-tmp fr-sm">F<\/span>/,"FROALA-SM")).replace(/<span class="fr-tmp fr-em">F<\/span>/,"FROALA-EM"),d.codeBeautifier&&(t=d.codeBeautifier.run(t,d.opts.codeBeautifierOptions)),h){n=t.indexOf("FROALA-SM"),(i=t.indexOf("FROALA-EM"))<n?n=i:i-=9;var s=(t=t.replace(/FROALA-SM/g,"").replace(/FROALA-EM/g,"")).substring(0,n).length-t.substring(0,n).replace(/\n/g,"").length,o=t.substring(0,i).length-t.substring(0,i).replace(/\n/g,"").length;n=t.substring(0,n).length-t.substring(0,t.substring(0,n).lastIndexOf("\n")+1).length,i=t.substring(0,i).length-t.substring(0,t.substring(0,i).lastIndexOf("\n")+1).length,h.setSize(null,d.opts.height?d.opts.height:"auto"),d.opts.heightMin&&d.$box.find(".CodeMirror-scroll").css("min-height",d.opts.heightMin),h.setValue(t),b=!r,h.focus(),b=!0,h.setSelection({line:s,ch:n},{line:o,ch:i}),h.refresh(),h.clearHistory()}else{n=t.indexOf("FROALA-SM"),i=t.indexOf("FROALA-EM")-9,d.opts.heightMin&&c.css("min-height",d.opts.heightMin),d.opts.height&&c.css("height",d.opts.height),d.opts.heightMax&&c.css("max-height",d.opts.height||d.opts.heightMax),c.val(t.replace(/FROALA-SM/g,"").replace(/FROALA-EM/g,"")).trigger("change");var a=f(d.o_doc).scrollTop();b=!r,c.focus(),b=!0,c.get(0).setSelectionRange(n,i),f(d.o_doc).scrollTop(a)}d.$tb.find(" > div > .fr-command, > div > .fr-btn-wrap > .fr-command").not(e).filter(function(){return d.opts.codeViewKeepActiveButtons.indexOf(f(this).data("cmd"))<0}).addClass("fr-disabled").attr("aria-disabled",!0),e.addClass("fr-active").attr("aria-pressed",!0),!d.helpers.isMobile()&&d.opts.toolbarInline&&d.toolbar.hide()}function A(e){void 0===e&&(e=!p());var t=d.$tb.find('.fr-command[data-cmd="html"]');e?(d.popups.hideAll(),i(t)):(d.$box.toggleClass("fr-code-view",!1),function n(e){var t=u();d.html.set(t),d.$el.blur(),d.$tb.find("> div > .fr-command, > div > .fr-btn-wrap > .fr-command").not(e).removeClass("fr-disabled").attr("aria-disabled",!1),e.removeClass("fr-active").attr("aria-pressed",!1),d.selection.setAtStart(d.el),d.selection.restore(),d.placeholder.refresh(),d.undo.saveStep()}(t))}function x(){p()&&A(!1),h&&h.toTextArea(),c.val("").removeData().remove(),c=null,m&&(m.remove(),m=null)}return{_init:function e(){if(d.events.on("focus",function(){d.opts.toolbarContainer&&function t(){var e=d.$tb.find('.fr-command[data-cmd="html"]');p()?(d.$tb.find(" > div > .fr-command").not(e).filter(function(){return d.opts.codeViewKeepActiveButtons.indexOf(f(this).data("cmd"))<0}).addClass("fr-disabled").attr("aria-disabled",!1),e.addClass("fr-active").attr("aria-pressed",!1)):(d.$tb.find(" > div > .fr-command").not(e).removeClass("fr-disabled").attr("aria-disabled",!1),e.removeClass("fr-active").attr("aria-pressed",!1))}()}),!d.$wp)return!1},toggle:A,isActive:p,get:u}},e.RegisterCommand("html",{title:"Code View",undo:!1,focus:!1,forcedRefresh:!0,toggle:!0,callback:function(){this.codeView.toggle()},plugin:"codeView"}),e.DefineIcon("html",{NAME:"code",SVG_KEY:"codeView"})});