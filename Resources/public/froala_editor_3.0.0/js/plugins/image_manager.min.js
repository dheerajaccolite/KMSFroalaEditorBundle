!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(require("FroalaEditor")):"function"==typeof define&&define.amd?define(["FroalaEditor"],a):a(e.FroalaEditor)}(this,function(A){"use strict";if(A=A&&A.hasOwnProperty("default")?A["default"]:A,Object.assign(A.DEFAULTS,{imageManagerLoadURL:"https://i.froala.com/load-files",imageManagerLoadMethod:"get",imageManagerLoadParams:{},imageManagerPreloader:null,imageManagerDeleteURL:"",imageManagerDeleteMethod:"post",imageManagerDeleteParams:{},imageManagerPageSize:12,imageManagerScrollOffset:20,imageManagerToggleTags:!0}),A.PLUGINS.imageManager=function(o){var g,l,n,s,d,m,f,c,u,p,h,v=o.$,M="image_manager",e=10,w=11,b=12,C=13,L=14,D=15,t=21,r=22,i={};function y(){var e=v(window).outerWidth();return e<768?2:e<1200?3:4}function P(){d.empty();for(var e=0;e<h;e++)d.append('<div class="fr-list-column"></div>')}function I(){if(u<f.length&&(d.outerHeight()<=n.outerHeight()+o.opts.imageManagerScrollOffset||n.scrollTop()+o.opts.imageManagerScrollOffset>d.outerHeight()-n.outerHeight())){c++;for(var e=o.opts.imageManagerPageSize*(c-1);e<Math.min(f.length,o.opts.imageManagerPageSize*c);e++)a(f[e])}}function a(i){var n=new Image,s=v(document.createElement("div")).attr("class","fr-image-container fr-empty fr-image-"+p++).attr("data-loading",o.language.translate("Loading")+"..").attr("data-deleting",o.language.translate("Deleting")+"..");R(!1),n.onload=function(){s.height(Math.floor(s.width()/n.width*n.height));var t=v(document.createElement("img"));if(i.thumb)t.attr("src",i.thumb);else{if(O(L,i),!i.url)return O(D,i),!1;t.attr("src",i.url)}if(i.url&&t.attr("data-url",i.url),i.tag)if(l.find(".fr-modal-more.fr-not-available").removeClass("fr-not-available"),l.find(".fr-modal-tags").show(),0<=i.tag.indexOf(",")){for(var e=i.tag.split(","),a=0;a<e.length;a++)e[a]=e[a].trim(),0===m.find('a[title="'+e[a]+'"]').length&&m.append('<a role="button" title="'+e[a]+'">'+e[a]+"</a>");t.attr("data-tag",e.join())}else 0===m.find('a[title="'+i.tag.trim()+'"]').length&&m.append('<a role="button" title="'+i.tag.trim()+'">'+i.tag.trim()+"</a>"),t.attr("data-tag",i.tag.trim());for(var r in i.name&&t.attr("alt",i.name),i)i.hasOwnProperty(r)&&"thumb"!==r&&"url"!==r&&"tag"!==r&&t.attr("data-"+r,i[r]);s.append(t).append(v(o.icon.create("imageManagerDelete")).addClass("fr-delete-img").attr("title",o.language.translate("Delete"))).append(v(o.icon.create("imageManagerInsert")).addClass("fr-insert-img").attr("title",o.language.translate("Insert"))),m.find(".fr-selected-tag").each(function(e,a){k(t,a.text)||s.hide()}),t.on("load",function(){s.removeClass("fr-empty"),s.height("auto"),u++,E(T(parseInt(t.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1)),R(!1),u%o.opts.imageManagerPageSize==0&&I()}),o.events.trigger("imageManager.imageLoaded",[t])},n.onerror=function(){u++,s.remove(),E(T(parseInt(s.attr("class").match(/fr-image-(\d+)/)[1],10)+1)),O(e,i),u%o.opts.imageManagerPageSize==0&&I()},n.src=i.thumb||i.url,S().append(s)}function S(){var r,i;return d.find(".fr-list-column").each(function(e,a){var t=v(a);0===e?(i=t.outerHeight(),r=t):t.outerHeight()<i&&(i=t.outerHeight(),r=t)}),r}function T(e){e===undefined&&(e=0);for(var a=[],t=p-1;e<=t;t--){var r=d.find(".fr-image-"+t);r.length&&(a.push(r),v(document.createElement("div")).attr("id","fr-image-hidden-container").append(r),d.find(".fr-image-"+t).remove())}return a}function E(e){for(var a=e.length-1;0<=a;a--)S().append(e[a])}function R(e){if(e===undefined&&(e=!0),!g.isVisible())return!0;var a=y();if(a!==h){h=a;var t=T();P(),E(t)}o.modals.resize(M),e&&I()}function U(e){var a={},t=e.data();for(var r in t)t.hasOwnProperty(r)&&"url"!==r&&"tag"!==r&&(a[r]=t[r]);return a}function x(e){var a=v(e.currentTarget).siblings("img"),t=g.data("instance")||o,r=g.data("current-image");if(o.modals.hide(M),t.image.showProgressBar(),r)r.data("fr-old-src",r.attr("src")),r.trigger("click");else{t.events.focus(!0),t.selection.restore();var i=t.position.getBoundingRect(),n=i.left+i.width/2+v(o.doc).scrollLeft(),s=i.top+i.height+v(o.doc).scrollTop();t.popups.setContainer("image.insert",o.$sc),t.popups.show("image.insert",n,s)}t.image.insert(a.data("url"),!1,U(a),r)}function H(e){var n=v(e.currentTarget).siblings("img"),a=o.language.translate("Are you sure? Image will be deleted.");confirm(a)&&(o.opts.imageManagerDeleteURL?!1!==o.events.trigger("imageManager.beforeDeleteImage",[n])&&(n.parent().addClass("fr-image-deleting"),v(this).ajax({method:o.opts.imageManagerDeleteMethod,url:o.opts.imageManagerDeleteURL,data:Object.assign(Object.assign({src:n.attr("src")},U(n)),o.opts.imageManagerDeleteParams),crossDomain:o.opts.requestWithCORS,withCredentials:o.opts.requestWithCredentials,headers:o.opts.requestHeaders,done:function(e,a,t){o.events.trigger("imageManager.imageDeleted",[e]);var r=T(parseInt(n.parent().attr("class").match(/fr-image-(\d+)/)[1],10)+1);n.parent().remove(),E(r),function i(){g.find("#fr-modal-tags > a").each(function(){0===g.find('#fr-image-list [data-tag*="'+v(this).text()+'"]').length&&v(this).removeClass("fr-selected-tag").hide()}),_()}(),R(!0)},fail:function(e){O(t,e.response||e.responseText)}})):O(r))}function O(e,a){10<=e&&e<20?s.hide():20<=e&&e<30&&v(".fr-image-deleting").removeClass("fr-image-deleting"),o.events.trigger("imageManager.error",[{code:e,message:i[e]},a])}function q(){var e=l.find(".fr-modal-head-line").outerHeight(),a=m.outerHeight();l.toggleClass("fr-show-tags"),l.hasClass("fr-show-tags")?(l.css("height",e+a),n.css("marginTop",e+a),m.find("a").css("opacity",1)):(l.css("height",e),n.css("marginTop",e),m.find("a").css("opacity",0))}function _(){var e=m.find(".fr-selected-tag");0<e.length?(d.find("img").parent().show(),e.each(function(e,r){d.find("img").each(function(e,a){var t=v(a);k(t,r.text)||t.parent().hide()})})):d.find("img").parent().show(),E(T()),I()}function j(e){e.preventDefault();var a=v(e.currentTarget);a.toggleClass("fr-selected-tag"),o.opts.imageManagerToggleTags&&a.siblings("a").removeClass("fr-selected-tag"),_()}function k(e,a){for(var t=(e.attr("data-tag")||"").split(","),r=0;r<t.length;r++)if(t[r]===a)return!0;return!1}return i[e]="Image cannot be loaded from the passed link.",i[w]="Error during load images request.",i[b]="Missing imageManagerLoadURL option.",i[C]="Parsing load response failed.",i[L]="Missing image thumb.",i[D]="Missing image URL.",i[t]="Error during delete image request.",i[r]="Missing imageManagerDeleteURL option.",{require:["image"],_init:function z(){if(!o.$wp&&"IMG"!==o.el.tagName)return!1},show:function G(){if(!g){var e,a='<div class="fr-modal-head-line"><i class="fr-modal-more fr-not-available" id="fr-modal-more-'.concat(o.sid,'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24""><title>').concat(o.language.translate("Tags"),"</title>").concat(A.SVG.tags,'</svg></i><h4 data-text="true">').concat(o.language.translate("Manage Images"),'</h4></div>\n      <div class="fr-modal-tags" id="fr-modal-tags"></div>');e=o.opts.imageManagerPreloader?'<img class="fr-preloader" id="fr-preloader" alt="'+o.language.translate("Loading")+'.." src="'+o.opts.imageManagerPreloader+'" style="display: none;">':'<span class="fr-preloader" id="fr-preloader" style="display: none;">'+o.language.translate("Loading")+"</span>",e+='<div class="fr-image-list" id="fr-image-list"></div>';var t=o.modals.create(M,a,e);g=t.$modal,l=t.$head,n=t.$body}g.data("current-image",o.image.get()),o.modals.show(M),s||function r(){s=g.find("#fr-preloader"),d=g.find("#fr-image-list"),m=g.find("#fr-modal-tags"),h=y(),P(),l.css("height",l.find(".fr-modal-head-line").outerHeight()),o.events.$on(v(o.o_win),"resize",function(){R(!!f)}),o.helpers.isMobile()&&(o.events.bindClick(d,"div.fr-image-container",function(e){g.find(".fr-mobile-selected").removeClass("fr-mobile-selected"),v(e.currentTarget).addClass("fr-mobile-selected")}),g.on(o._mousedown,function(){g.find(".fr-mobile-selected").removeClass("fr-mobile-selected")})),o.events.bindClick(d,".fr-insert-img",x),o.events.bindClick(d,".fr-delete-img",H),g.on(o._mousedown+" "+o._mouseup,function(e){e.stopPropagation()}),g.on(o._mousedown,"*",function(){o.events.disableBlur()}),n.on("scroll",I),o.events.bindClick(g,"i#fr-modal-more-"+o.sid,q),o.events.bindClick(m,"a",j)}(),function i(){s.show(),d.find(".fr-list-column").empty(),o.opts.imageManagerLoadURL?v(this).ajax({url:o.opts.imageManagerLoadURL,method:o.opts.imageManagerLoadMethod,data:o.opts.imageManagerLoadParams,dataType:"json",crossDomain:o.opts.requestWithCORS,withCredentials:o.opts.requestWithCredentials,headers:o.opts.requestHeaders,done:function(e,a,t){o.events.trigger("imageManager.imagesLoaded",[e]),function r(e,a){try{d.find(".fr-list-column").empty(),p=u=c=0,f=e,I()}catch(t){O(C,a)}}(e,t.response),s.hide()},fail:function(e){O(w,e.response||e.responseText)}}):O(b)}()},hide:function $(){o.modals.hide(M)}}},!A.PLUGINS.image)throw new Error("Image manager plugin requires image plugin.");A.DEFAULTS.imageInsertButtons.push("imageManager"),A.RegisterCommand("imageManager",{title:"Browse",undo:!1,focus:!1,modal:!0,callback:function(){this.imageManager.show()},plugin:"imageManager"}),A.DefineIcon("imageManager",{NAME:"folder",SVG_KEY:"imageManager"}),A.DefineIcon("imageManagerInsert",{NAME:"plus",SVG_KEY:"add"}),A.DefineIcon("imageManagerDelete",{NAME:"trash",SVG_KEY:"remove"})});